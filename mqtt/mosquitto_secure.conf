# =============================================================================
# CleanRoute MQTT Broker Configuration - SECURE
# TLS Encryption + Username/Password Authentication
# =============================================================================

# -----------------------------------------------------------------------------
# General Settings
# -----------------------------------------------------------------------------
persistence true
persistence_location /var/lib/mosquitto/
log_dest stdout
log_type all
connection_messages true

# -----------------------------------------------------------------------------
# INSECURE Listener (Port 1883) - FOR DEVELOPMENT ONLY
# Comment this out in production!
# -----------------------------------------------------------------------------
listener 1883 localhost
allow_anonymous true

# -----------------------------------------------------------------------------
# SECURE Listener (Port 8883) - TLS + Authentication
# -----------------------------------------------------------------------------
listener 8883

# TLS/SSL Configuration
cafile /home/thevinduk/Repositories/cleanroute-backend/mqtt/certs/ca.crt
certfile /home/thevinduk/Repositories/cleanroute-backend/mqtt/certs/server.crt
keyfile /home/thevinduk/Repositories/cleanroute-backend/mqtt/certs/server.key

# Require TLS 1.2 or higher (reject older insecure versions)
tls_version tlsv1.2

# -----------------------------------------------------------------------------
# Authentication
# -----------------------------------------------------------------------------
# Require username/password for secure port
allow_anonymous false
password_file /home/thevinduk/Repositories/cleanroute-backend/mqtt/passwd

# -----------------------------------------------------------------------------
# Access Control (ACL) - Optional but recommended
# Uncomment to enable topic-level access control
# -----------------------------------------------------------------------------
# acl_file /home/thevinduk/Repositories/cleanroute-backend/mqtt/acl

# -----------------------------------------------------------------------------
# Security Hardening
# -----------------------------------------------------------------------------
# Max connections per client
max_connections -1

# Keep-alive settings (in seconds)
# Disconnect clients that don't send keep-alive within this time
max_keepalive 120

# Message size limit (256KB - enough for telemetry, prevents abuse)
message_size_limit 262144
